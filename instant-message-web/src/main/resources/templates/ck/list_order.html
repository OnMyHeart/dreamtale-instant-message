<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>订单列表</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link href="http://dreamtale.iok.la/static/admin/css/bootstrap.min.css?v=3.3.6" rel="stylesheet" />
    <link href="http://dreamtale.iok.la/static/admin/css/font-awesome.css?v=4.4.0" rel="stylesheet" />
    <link href="http://dreamtale.iok.la/static/admin/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet" />
    <link href="http://dreamtale.iok.la/static/admin/css/animate.css" rel="stylesheet" />
    <link href="http://dreamtale.iok.la/static/admin/css/style.css?v=4.1.0" rel="stylesheet" />
</head>

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <!-- Panel Other -->
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>出货列表</h5>
        </div>
        <div class="ibox-content">
            <div class="row row-lg">
                <div class="col-sm-12">
                </div>
            </div>
            <div class="row row-lg">
                <div class="col-sm-12">
                    <!-- Example Events -->
                    <div class="example-wrap">
                        <div class="example">
                            <div class="btn-group hidden-xs" id="exampleTableEventsToolbar" role="group">
                                <button type="button" class="btn btn-outline btn-default" id="add">
                                    <i class="glyphicon glyphicon-plus" aria-hidden="true">新增订单</i>
                                </button>
                            </div>
                            <table id="exampleTableEvents" data-mobile-responsive="true"></table>
                        </div>
                    </div>
                    <!-- End Example Events -->
                </div>
            </div>
        </div>
    </div>
    <!-- End Panel Other -->
</div>
<!-- 全局js -->
<script src="http://dreamtale.iok.la/static/admin/js/jquery.min.js?v=2.1.4"></script>
<script src="http://dreamtale.iok.la/static/admin/js/bootstrap.min.js?v=3.3.6"></script>
<!-- 自定义js -->
<script src="http://dreamtale.iok.la/static/admin/js/content.js?v=1.0.0"></script>
<script src="http://dreamtale.iok.la/static/common/js/common.js?v=1.0.0"></script>
<!-- Bootstrap table -->
<script src="http://dreamtale.iok.la/static/admin/js/plugins/bootstrap-table/bootstrap-table.min.js?v=1.9.0"></script>
<script src="http://dreamtale.iok.la/static/admin/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js?v=1.9.0"></script>
<script src="http://dreamtale.iok.la/static/admin/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js?v=1.0.0"></script>
<!-- layer 弹框 -->
<script src="http://dreamtale.iok.la/static/layer/dist/layer.js?v=1.0.0"></script>
<!-- Peity -->
<script>
    $(function() {
        $('#exampleTableEvents').bootstrapTable({
            url: "queryOrderList",
            search: false,
            striped: true,
            pagination: true,
            showRefresh: true,
            showToggle: true,
            showColumns: true,
            dataType: "json",
            iconSize: 'outline',
            cache: false,
            toolbar: '#exampleTableEventsToolbar',
            icons: {
                refresh: 'glyphicon-repeat',
                toggle: 'glyphicon-list-alt',
                columns: 'glyphicon-list'
            },
            sidePagination: "server",
            columns: [
                {field:"id",title:"订单编号",align: 'center', valign: 'middle',data:"id"},
                {field:"productNo",title:"产品条形码",align: 'center', valign: 'middle',data:"productNo"},
                {field:"productName",title:"品名",align: 'center', valign: 'middle',data:"productName"},
                {field:"unit",title:"单位",align: 'center', valign: 'middle',data:"unit"},
                {field:"specification",title:"规格",align: 'center', valign: 'middle',data:"specification"},
                {field:"price",title:"业务员价",align: 'center', valign: 'middle',data:"price"},
                {field:"count",title:"出货数量",align: 'center', valign: 'middle',data:"count"},
                {field:"amount",title:"出货金额",align: 'center', valign: 'middle',data:"amount"},
                {field:"createTime",title:"出货日期",align: 'center', valign: 'middle',data:"createTime"},
                {field:"salesmanName",title:"业务员",align: 'center', valign: 'middle',data:"salesmanName"},
                {field:"districtName",title:"业务员所属区域",align: 'center', valign: 'middle',data:"districtName"}
            ]
        });

        $("#add").on("click", function () {

            //加载业务员下拉框
            var ajaxObj = {url: '/admin/ck/user/queryUserList',param:{"offset":0, "limit":100},method:"GET",async:false};
            commonJS.sendAjaxRequest(ajaxObj, function (data) {
                if(data.rows!=null){
                    var html = "<option value=''>请选择</option>";
                    data.rows.forEach(function (t) {
                        html += "<option value='"+t.id+"'>"+t.name+"</option>";
                    });
                    $("#userId").html(html);
                } else {
                    layer.message("未获取到业务员列表！");
                }
            });

            //加载商品列表
            $('#productList').bootstrapTable({
                url: "/admin/ck/product/queryProductList",
                search: false,
                striped: true,
                pagination: true,
                showRefresh: true,
                showToggle: true,
                showColumns: true,
                dataType: "json",
                iconSize: 'outline',
                cache: false,
                sidePagination: "server",
                columns: [
                    {checkBox:true},
                    {field:"id",title:"产品编号",align: 'center', valign: 'middle',data:"id"},
                    {field:"no",title:"产品条形码",align: 'center', valign: 'middle',data:"no"},
                    {field:"name",title:"产品名称",align: 'center', valign: 'middle',data:"name"},
                    {field:"unit",title:"单位",align: 'center', valign: 'middle',data:"unit"},
                    {field:"specification",title:"规格",align: 'center', valign: 'middle',data:"specification"},
                    {field:"price",title:"价格",align: 'center', valign: 'middle',data:"price"},
                    {field:"batchNo",title:"产品批次号",align: 'center', valign: 'middle',data:"count"},
                    {field:"lowNo",title:"产品小号",align: 'center', valign: 'middle',data:"amount"}
                ]
            });

            layer.open({
                title: "新增订单",
                type: 1,
                skin: 'layui-layer-rim', //加上边框
                area: ['90%', '80%'], //宽高
                content: $("#addOrder"),
                btn: ['确定','取消'],
                btn1: function (index) {
                    var name = $("#name").val();
                    if(name==null || name=="" || name==undefined){
                        layer.message("品名不能为空！");
                        return;
                    }
                    var unit = $("#unit").val();
                    if(unit==null || unit=="" || unit==undefined){
                        layer.message("单位不能为空！");
                        return;
                    }
                    var specification = $("#specification").val();
                    if(specification==null || specification=="" || specification==undefined){
                        layer.message("规格不能为空！");
                        return;
                    }
                    var price = $("#price").val();
                    if(price==null || price=="" || price==undefined){
                        layer.message("价格不能为空！");
                        return;
                    }
                    var batchNo = $("#batchNo").val();
                    if(batchNo==null || batchNo=="" || batchNo==undefined){
                        layer.message("批次号不能为空！");
                        return;
                    }
                    var lowNo = $("#lowNo").val();
                    if(lowNo==null || lowNo=="" || lowNo==undefined){
                        layer.message("小号不能为空！");
                        return;
                    }
                    var no = $("#no").val();
                    var param = {
                        no: no,
                        name: name,
                        unit: unit,
                        specification: specification,
                        price: price,
                        batchNo: batchNo,
                        lowNo: lowNo
                    };
                    var ajaxObj = {url: 'add',param:param,method:"POST",async:false};
                    commonJS.sendAjaxRequest(ajaxObj, function (data) {
                        if(data.data==true){
                            layer.msg('新增产品成功！');
                        } else {
                            layer.msg("新增产品失败！")
                        }
                        layer.close(index);
                    });
                },
                btn2: function (index) {
                    layer.close(index);
                }
            });
        });

    });
</script>
</body>
<div id="addOrder" style="display: none">
    <div class="col-sm-12">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <form method="get" class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">业务员</label>
                        <div class="col-sm-3">
                            <select class="form-control m-b" id="userId" name="userId">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>
                    <table id="productList" data-mobile-responsive="true"></table>
                </form>
            </div>
        </div>
    </div>
</div>
</html>
